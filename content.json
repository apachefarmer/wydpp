{"pages":[{"title":"Categories","date":"2023-08-29T08:59:12.848Z","path":"categories/index.html","text":""},{"title":"","date":"2023-08-29T08:59:12.848Z","path":"sentinel/Sentinel限流原理.html","text":"&#x3D;&#x3D;⚠ Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠&#x3D;&#x3D; Text ElementsLeapArray结构 ^TluluZIz sampleCount默认值&#x3D;2，时间窗口是2个intervalInMs默认值&#x3D;1000，标识区间长度是1000mswindowLengthInMs每个窗口的时间长度&#x3D;intervalInMs&#x2F;sampleCount&#x3D;1000ms&#x2F;2&#x3D;500ms ^1fShRGKP null ^gzNu9gJH null ^TjA0N5xa 初始化 ^uPECbDft 第一次请求 ^WGPe2M7N null ^TZyXTDgi 假设请求时间戳timeMillis：16927829386751.计算当前请求在哪个窗口上使用timeMillis除以窗口长度求整数，long timeId &#x3D; timeMIllis&#x2F;windowLengthInMs &#x3D; 1692782938675&#x2F;500 &#x3D; 3385565877计算timeId应该落在哪个窗口上,timeId对sampleCount取模int idx &#x3D; timeId%sampleCount &#x3D; 3385565877%2 &#x3D; 1得到当前请求落在第二个窗口上2.计算窗口开始时间：long windowStart &#x3D; timeMillis - timeMillis%windowLengthInMs &#x3D; 1692782938675 - 1692782938675%500 &#x3D; 16927829385003.获取第二个窗口信息WindowWrap old &#x3D; array.get(1);如果old&#x3D;&#x3D;null说明还没有创建过，新建一个WindowWrap并使用cas放入arry中。4.窗口请求量+1WindowDrap.value.addPass(1) &#x3D; MetricBucket.add(pass,1) &#x3D; LongAdder.add(1); ^iYODK5t9 AtomicReferenceArray&lt;WindowWrap&gt; array &#x3D; new AtomicReferenceArray&lt;&gt;(sampleCount); ^2vQcsgnx MetricBucket ^bs7qDQ0t LongAdder: 1 ^rFX4RB1J … ^lxOrBnSS 5.FlowSlot限流原理：FlowRuleChecker.chekFlow DefaultController.canPass：Node中所有窗口的qps数据之和&#x2F;1得到当前LeapArray中的QPS 如果当前qps+1 &gt; 限制数，则返回fasle， FlowRuleChecker抛出异常FlowException 如果当前qps+1&lt;&#x3D; 限制qps，则返回true，执行后续slot，StaticticNode qps+1 ^jO76IbF9 %% Drawing123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768&#123; &quot;type&quot;: &quot;excalidraw&quot;, &quot;version&quot;: 2, &quot;source&quot;: &quot;https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/1.9.12&quot;, &quot;elements&quot;: [ &#123; &quot;type&quot;: &quot;rectangle&quot;, &quot;version&quot;: 473, &quot;versionNonce&quot;: 1172588455, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;HP_tG8wkY-KYnj5chb6wm&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -326.1144104003906, &quot;y&quot;: -508.24764251708984, &quot;strokeColor&quot;: &quot;#000000&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 615.5287475585938, &quot;height&quot;: 89.0870361328125, &quot;seed&quot;: 1061446631, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 1 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 165, &quot;versionNonce&quot;: 203649289, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;TluluZIz&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -472.7499694824219, &quot;y&quot;: -663.7041549682617, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 139.15992736816406, &quot;height&quot;: 25, &quot;seed&quot;: 1178319879, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692783787039, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;LeapArray结构&quot;, &quot;rawText&quot;: &quot;LeapArray结构&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;LeapArray结构&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;line&quot;, &quot;version&quot;: 55, &quot;versionNonce&quot;: 1231731399, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;eksi-JsXHg2TMNbLfHoiM&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -11.95001220703125, &quot;y&quot;: -507.7041244506836, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 0, &quot;height&quot;: 88.80001831054688, &quot;seed&quot;: 1410800775, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 2 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;startBinding&quot;: null, &quot;endBinding&quot;: null, &quot;lastCommittedPoint&quot;: null, &quot;startArrowhead&quot;: null, &quot;endArrowhead&quot;: null, &quot;points&quot;: [ [ 0, 0 ], [ 0, 88.80001831054688 ] ] &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 248, &quot;versionNonce&quot;: 1321921993, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;1fShRGKP&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -304.75, &quot;y&quot;: -603.7041244506836, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 794.2195434570312, &quot;height&quot;: 75, &quot;seed&quot;: 1961753607, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692783193585, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;sampleCount默认值=2，时间窗口是2个\\nintervalInMs默认值=1000，标识区间长度是1000ms\\nwindowLengthInMs每个窗口的时间长度=intervalInMs/sampleCount=1000ms/2=500ms&quot;, &quot;rawText&quot;: &quot;sampleCount默认值=2，时间窗口是2个\\nintervalInMs默认值=1000，标识区间长度是1000ms\\nwindowLengthInMs每个窗口的时间长度=intervalInMs/sampleCount=1000ms/2=500ms&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;sampleCount默认值=2，时间窗口是2个\\nintervalInMs默认值=1000，标识区间长度是1000ms\\nwindowLengthInMs每个窗口的时间长度=intervalInMs/sampleCount=1000ms/2=500ms&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 68 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 58, &quot;versionNonce&quot;: 683392039, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;gzNu9gJH&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -202.35003662109375, &quot;y&quot;: -478.9041061401367, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 31.219970703125, &quot;height&quot;: 25, &quot;seed&quot;: 1437237929, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;null&quot;, &quot;rawText&quot;: &quot;null&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;null&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 77, &quot;versionNonce&quot;: 520797641, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;TjA0N5xa&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: 105.8499755859375, &quot;y&quot;: -479.70409393310547, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 31.219970703125, &quot;height&quot;: 25, &quot;seed&quot;: 1190870505, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;null&quot;, &quot;rawText&quot;: &quot;null&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;null&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 32, &quot;versionNonce&quot;: 979345223, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;uPECbDft&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -442.3499755859375, &quot;y&quot;: -480.50411224365234, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 60, &quot;height&quot;: 25, &quot;seed&quot;: 1851122857, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;初始化&quot;, &quot;rawText&quot;: &quot;初始化&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;初始化&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 47, &quot;versionNonce&quot;: 1415716009, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;WGPe2M7N&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -448.1500244140625, &quot;y&quot;: -343.7041244506836, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 100, &quot;height&quot;: 25, &quot;seed&quot;: 142790919, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692782894393, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;第一次请求&quot;, &quot;rawText&quot;: &quot;第一次请求&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;第一次请求&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;rectangle&quot;, &quot;version&quot;: 864, &quot;versionNonce&quot;: 1618562439, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;2DZXA_0Yi6mgQ41v64XXp&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -330.7143249511719, &quot;y&quot;: 146.41256111681463, &quot;strokeColor&quot;: &quot;#000000&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 647.5287475585936, &quot;height&quot;: 175.48699951171872, &quot;seed&quot;: 1132070921, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 1 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false &#125;, &#123; &quot;type&quot;: &quot;line&quot;, &quot;version&quot;: 468, &quot;versionNonce&quot;: 2024895081, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;fnB-cgsGyJQSGPMaye9L2&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -17.34991455078125, &quot;y&quot;: 146.95607918322088, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 0, &quot;height&quot;: 171.19998168945312, &quot;seed&quot;: 955129577, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 2 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;startBinding&quot;: null, &quot;endBinding&quot;: null, &quot;lastCommittedPoint&quot;: null, &quot;startArrowhead&quot;: null, &quot;endArrowhead&quot;: null, &quot;points&quot;: [ [ 0, 0 ], [ 0, 171.19998168945312 ] ] &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 477, &quot;versionNonce&quot;: 992216231, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;TZyXTDgi&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: 135.6500244140625, &quot;y&quot;: 214.15612190783025, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 31.219970703125, &quot;height&quot;: 25, &quot;seed&quot;: 104872105, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;null&quot;, &quot;rawText&quot;: &quot;null&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;null&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 923, &quot;versionNonce&quot;: 1593698921, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;iYODK5t9&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -340.74993896484375, &quot;y&quot;: -301.1708297729492, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 1025.3192138671875, &quot;height&quot;: 425, &quot;seed&quot;: 968519177, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785628601, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;假设请求时间戳timeMillis：1692782938675\\n1.计算当前请求在哪个窗口上\\n使用timeMillis除以窗口长度求整数，\\nlong timeId = timeMIllis/windowLengthInMs = 1692782938675/500 = 3385565877\\n计算timeId应该落在哪个窗口上,timeId对sampleCount取模\\nint idx = timeId%sampleCount = 3385565877%2 = 1\\n得到当前请求落在第二个窗口上\\n2.计算窗口开始时间：\\nlong windowStart = timeMillis - timeMillis%windowLengthInMs = 1692782938675 - 1692782938675%500\\n = 1692782938500\\n3.获取第二个窗口信息\\nWindowWrap old = array.get(1);\\n如果old==null说明还没有创建过，新建一个WindowWrap并使用cas放入arry中。\\n4.窗口请求量+1\\nWindowDrap.value.addPass(1) = MetricBucket.add(pass,1) = LongAdder.add(1);\\n\\n&quot;, &quot;rawText&quot;: &quot;假设请求时间戳timeMillis：1692782938675\\n1.计算当前请求在哪个窗口上\\n使用timeMillis除以窗口长度求整数，\\nlong timeId = timeMIllis/windowLengthInMs = 1692782938675/500 = 3385565877\\n计算timeId应该落在哪个窗口上,timeId对sampleCount取模\\nint idx = timeId%sampleCount = 3385565877%2 = 1\\n得到当前请求落在第二个窗口上\\n2.计算窗口开始时间：\\nlong windowStart = timeMillis - timeMillis%windowLengthInMs = 1692782938675 - 1692782938675%500\\n = 1692782938500\\n3.获取第二个窗口信息\\nWindowWrap old = array.get(1);\\n如果old==null说明还没有创建过，新建一个WindowWrap并使用cas放入arry中。\\n4.窗口请求量+1\\nWindowDrap.value.addPass(1) = MetricBucket.add(pass,1) = LongAdder.add(1);\\n\\n&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;假设请求时间戳timeMillis：1692782938675\\n1.计算当前请求在哪个窗口上\\n使用timeMillis除以窗口长度求整数，\\nlong timeId = timeMIllis/windowLengthInMs = 1692782938675/500 = 3385565877\\n计算timeId应该落在哪个窗口上,timeId对sampleCount取模\\nint idx = timeId%sampleCount = 3385565877%2 = 1\\n得到当前请求落在第二个窗口上\\n2.计算窗口开始时间：\\nlong windowStart = timeMillis - timeMillis%windowLengthInMs = 1692782938675 - 1692782938675%500\\n = 1692782938500\\n3.获取第二个窗口信息\\nWindowWrap old = array.get(1);\\n如果old==null说明还没有创建过，新建一个WindowWrap并使用cas放入arry中。\\n4.窗口请求量+1\\nWindowDrap.value.addPass(1) = MetricBucket.add(pass,1) = LongAdder.add(1);\\n\\n&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 418 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 298, &quot;versionNonce&quot;: 578784807, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;2vQcsgnx&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -304.949951171875, &quot;y&quot;: -644.237419128418, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 889.9193115234375, &quot;height&quot;: 25, &quot;seed&quot;: 729180775, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692784016622, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;AtomicReferenceArray&lt;WindowWrap&lt;T&gt;&gt; array = new AtomicReferenceArray&lt;&gt;(sampleCount);&quot;, &quot;rawText&quot;: &quot;AtomicReferenceArray&lt;WindowWrap&lt;T&gt;&gt; array = new AtomicReferenceArray&lt;&gt;(sampleCount);&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;AtomicReferenceArray&lt;WindowWrap&lt;T&gt;&gt; array = new AtomicReferenceArray&lt;&gt;(sampleCount);&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;rectangle&quot;, &quot;version&quot;: 131, &quot;versionNonce&quot;: 2089368905, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;0Ptv034uNyakVar1lIF5d&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -311.95001220703125, &quot;y&quot;: 161.89582061767578, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 264, &quot;height&quot;: 139.19998168945315, &quot;seed&quot;: 879961129, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 3 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 39, &quot;versionNonce&quot;: 1504368583, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;bs7qDQ0t&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -295.14996337890625, &quot;y&quot;: 176.29581451416016, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 128.4998779296875, &quot;height&quot;: 25, &quot;seed&quot;: 605475049, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;MetricBucket&quot;, &quot;rawText&quot;: &quot;MetricBucket&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;MetricBucket&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;rectangle&quot;, &quot;version&quot;: 109, &quot;versionNonce&quot;: 216312873, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;qE2q7-Q8NlwdtaEIg89-e&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -292.8499450683594, &quot;y&quot;: 236.79586029052734, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 217, &quot;height&quot;: 39, &quot;seed&quot;: 686136233, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 3 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false &#125;, &#123; &quot;type&quot;: &quot;line&quot;, &quot;version&quot;: 96, &quot;versionNonce&quot;: 573196007, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;us64Gkr3vdf465J3SPrTN&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -155.95001220703128, &quot;y&quot;: 236.29581451416016, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 1.5999755859375, &quot;height&quot;: 39.199951171875, &quot;seed&quot;: 377347815, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: &#123; &quot;type&quot;: 2 &#125;, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;startBinding&quot;: null, &quot;endBinding&quot;: null, &quot;lastCommittedPoint&quot;: null, &quot;startArrowhead&quot;: null, &quot;endArrowhead&quot;: null, &quot;points&quot;: [ [ 0, 0 ], [ -1.5999755859375, 39.199951171875 ] ] &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 102, &quot;versionNonce&quot;: 1792811559, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;rFX4RB1J&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -277.54998779296875, &quot;y&quot;: 246.29581451416016, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 113.730224609375, &quot;height&quot;: 24.083910568815515, &quot;seed&quot;: 1638997001, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785811494, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 19.26712845505241, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;LongAdder: 1&quot;, &quot;rawText&quot;: &quot;LongAdder: 1&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;LongAdder: 1&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 17 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 58, &quot;versionNonce&quot;: 53400071, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;lxOrBnSS&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -122.54998779296875, &quot;y&quot;: 240.69583892822266, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 16.439987182617188, &quot;height&quot;: 25, &quot;seed&quot;: 146158567, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692785794070, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 20, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;...&quot;, &quot;rawText&quot;: &quot;...&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;...&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 18 &#125;, &#123; &quot;type&quot;: &quot;text&quot;, &quot;version&quot;: 585, &quot;versionNonce&quot;: 303802601, &quot;isDeleted&quot;: false, &quot;id&quot;: &quot;jO76IbF9&quot;, &quot;fillStyle&quot;: &quot;hachure&quot;, &quot;strokeWidth&quot;: 1, &quot;strokeStyle&quot;: &quot;solid&quot;, &quot;roughness&quot;: 1, &quot;opacity&quot;: 100, &quot;angle&quot;: 0, &quot;x&quot;: -327.8283437093097, &quot;y&quot;: 340.7245475849203, &quot;strokeColor&quot;: &quot;#1e1e1e&quot;, &quot;backgroundColor&quot;: &quot;transparent&quot;, &quot;width&quot;: 824.6281127929688, &quot;height&quot;: 236.98930312594337, &quot;seed&quot;: 345958855, &quot;groupIds&quot;: [], &quot;frameId&quot;: null, &quot;roundness&quot;: null, &quot;boundElements&quot;: [], &quot;updated&quot;: 1692865017988, &quot;link&quot;: null, &quot;locked&quot;: false, &quot;fontSize&quot;: 18.959144250075468, &quot;fontFamily&quot;: 1, &quot;text&quot;: &quot;\\n\\n5.FlowSlot限流原理：\\nFlowRuleChecker.chekFlow\\n DefaultController.canPass：Node中所有窗口的qps数据之和/1得到当前LeapArray中的QPS\\n 如果当前qps+1 &gt; 限制数，则返回fasle，\\n FlowRuleChecker抛出异常FlowException\\n 如果当前qps+1&lt;= 限制qps，则返回true，执行后续slot，StaticticNode qps+1\\n \\n&quot;, &quot;rawText&quot;: &quot;\\n\\n5.FlowSlot限流原理：\\nFlowRuleChecker.chekFlow\\n DefaultController.canPass：Node中所有窗口的qps数据之和/1得到当前LeapArray中的QPS\\n 如果当前qps+1 &gt; 限制数，则返回fasle，\\n FlowRuleChecker抛出异常FlowException\\n 如果当前qps+1&lt;= 限制qps，则返回true，执行后续slot，StaticticNode qps+1\\n \\n&quot;, &quot;textAlign&quot;: &quot;left&quot;, &quot;verticalAlign&quot;: &quot;top&quot;, &quot;containerId&quot;: null, &quot;originalText&quot;: &quot;\\n\\n5.FlowSlot限流原理：\\nFlowRuleChecker.chekFlow\\n DefaultController.canPass：Node中所有窗口的qps数据之和/1得到当前LeapArray中的QPS\\n 如果当前qps+1 &gt; 限制数，则返回fasle，\\n FlowRuleChecker抛出异常FlowException\\n 如果当前qps+1&lt;= 限制qps，则返回true，执行后续slot，StaticticNode qps+1\\n \\n&quot;, &quot;lineHeight&quot;: 1.25, &quot;baseline&quot;: 229 &#125; ], &quot;appState&quot;: &#123; &quot;theme&quot;: &quot;light&quot;, &quot;viewBackgroundColor&quot;: &quot;#ffffff&quot;, &quot;currentItemStrokeColor&quot;: &quot;#1e1e1e&quot;, &quot;currentItemBackgroundColor&quot;: &quot;transparent&quot;, &quot;currentItemFillStyle&quot;: &quot;hachure&quot;, &quot;currentItemStrokeWidth&quot;: 1, &quot;currentItemStrokeStyle&quot;: &quot;solid&quot;, &quot;currentItemRoughness&quot;: 1, &quot;currentItemOpacity&quot;: 100, &quot;currentItemFontFamily&quot;: 1, &quot;currentItemFontSize&quot;: 20, &quot;currentItemTextAlign&quot;: &quot;left&quot;, &quot;currentItemStartArrowhead&quot;: null, &quot;currentItemEndArrowhead&quot;: &quot;arrow&quot;, &quot;scrollX&quot;: 911.1736806233722, &quot;scrollY&quot;: 346.2588491112624, &quot;zoom&quot;: &#123; &quot;value&quot;: 0.6000000000000001 &#125;, &quot;currentItemRoundness&quot;: &quot;round&quot;, &quot;gridSize&quot;: null, &quot;currentStrokeOptions&quot;: null, &quot;previousGridSize&quot;: null, &quot;frameRendering&quot;: &#123; &quot;enabled&quot;: true, &quot;clip&quot;: true, &quot;name&quot;: true, &quot;outline&quot;: true &#125; &#125;, &quot;files&quot;: &#123;&#125;&#125; %%"},{"title":"About","date":"2023-08-29T08:59:12.848Z","path":"about/index.html","text":""},{"title":"Tags","date":"2023-08-29T08:59:12.848Z","path":"tags/index.html","text":""}],"posts":[{"title":"test","date":"2023-08-29T08:09:07.000Z","path":"wiki/sentinel/","text":"参考资料","tags":[],"categories":[]},{"title":"sentinel限流原理","date":"2023-08-29T07:11:43.000Z","path":"wiki/sentinel/sentinel限流原理/","text":"参考资料","tags":[],"categories":[{"name":"sentinel","slug":"sentinel","permalink":"https://wydpp.github.io/categories/sentinel/"}]},{"title":"Hello World","date":"2023-08-29T02:48:56.610Z","path":"wiki/hello-world/","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","tags":[],"categories":[]}],"categories":[{"name":"sentinel","slug":"sentinel","permalink":"https://wydpp.github.io/categories/sentinel/"}],"tags":[]}